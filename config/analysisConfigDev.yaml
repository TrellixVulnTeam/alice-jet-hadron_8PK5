---
name: "Analysis config for Jet-H analysis"
# The following are defined by user arguments and a default is not provided:
#   - Energy
#   - Collision system
#   - Event activity
#   - Leading hadron bias type

# Specify all possible desired leading hadron bias values
leadingHadronBiasValues:
    track:
        value: 5
    2.76:
        central:
            cluster:
                value: 10
        semi_central:
            cluster:
                value: 6

# Default iterable options
iterables:
    reaction_plane_orientation: true
    qvector: false

# Basic configuration
inputFilename: "trains/{collision_system}/{trainNumber}/AnalysisResults.root"
inputListName: "AliAnalysisTaskJetH_tracks_caloClusters_{leading_hadron_bias}R2"
# yamllint disable-line rule:line-length
outputPrefix: "output/{collision_system}/{trainNumber}/dev/test/{event_activity}/{leading_hadron_bias}/RP{reaction_plane_orientation}/qVec{qvector}/{task_name}"
outputFilename: "{collision_system}Correlations.root"
printingExtensions: ["pdf", "eps"]
aliceLabel: work_in_progress
trainNumber: &trainNumber 3360

# Convenience variables
# 11h track and jet pt bins
_jet_pt_bins_11h: &JetPtBins11h !JetPtBins [15, 20, 40, 60, 200]
_track_pt_bins_11h: &TrackPtBins11h !TrackPtBins [0.5, 1.0, 1.5, 2.0, 3.0, 4.0, 5.0, 6.0, 10.0]
constituent_cut_biased_jets: true
# For high associated pt fits
_fixed_v4: &fixed_v4
    v4_t: 0
    fix_v4_t: true
    v4_a: 0
    fix_v4_a: true

# Helpful binning information
etaBins: !EtaBins [-1.5, -1.2, -0.8, -0.6, -0.4, 0, 0.4, 0.6, 0.8, 1.2, 1.5]

#############################################
# Correlations analysis related configuration
#############################################
Correlations:
    # These define the regions for projecting, fitting
    deltaEtaRanges:
        # NOTE: They are assumed to be symmetric with respect to eta.
        #       This leads to discontinuous selection ranges in the background.
        signalDominated: [0, 0.6]
        backgroundDominated: [0.8, 1.2]
    deltaPhiRanges:
        # +/- pi/2 from 0. The values are multiplied by pi.
        nearSide: [-0.5, 0.5]
        # +/- pi/2 from pi. The values are multiplied by pi.
        # These values are defined relative to pi.
        awaySide: [-0.5, 0.5]
    mixedEventNormalizationOptions:
        etaRange: [-0.3, 0.3]
        compareOptions: false
    joelsCorrelationsFilePath: "inputData/PbPb/2.76/central/clusterBias10/joelsCorrelations"
    2d_rebin_factors: [2, 1]
    1d_rebin_factor_delta_eta: 1
    1d_rebin_factor_delta_phi: 1
    mixed_events_with_EP_dependence: false
    use_broader_high_pt_mixed_events: true
    # Should be +/- pi/3 from the central value.
    # This value will multiplied by pi.
    delta_phi_yield_limit: 0.33333
    # This value is just 0.6 (ie corresponding to the signal dominated region).
    delta_eta_yield_limit: 0.6
    separate_background_errors: true
    processingOptions:
        # 2D
        generate2DCorrelations: false
        plot2DCorrelations: false
        plotRPFHighlights: false
        # 1D
        generate1DCorrelations: false
        plot1DCorrelations: false
        plot1DCorrelationsWithROOT: false
    override:
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{trainNumber}/dev/{event_activity}/{leading_hadron_bias}/{task_name}/RP{reaction_plane_orientation}"
        2.76:
            trainNumber: 3360
        5.02:
            trainNumber: 4358
        iterables:
            reaction_plane_orientation: true
            #track_pt_bin: *TrackPtBins11h
            # NOTE: The individual binning is numbered from the bin 0.15 - 0.5 as bin 1.
            track_pt_bin:
                - !TrackPtBin
                  bin: 2
                  range: !SelectedRange [0.5, 1.0]
                - !TrackPtBin
                  bin: 3
                  range: !SelectedRange [1.0, 1.5]
                - !TrackPtBin
                  bin: 4
                  range: !SelectedRange [1.5, 2.0]
                - !TrackPtBin
                  bin: 5
                  range: !SelectedRange [2.0, 3.0]
                - !TrackPtBin
                  bin: 6
                  range: !SelectedRange [3.0, 4.0]
                #- !TrackPtBin
                #  bin: 7
                #  range: !SelectedRange [4.0, 5.0]
                #- !TrackPtBin
                #  bin: 8
                #  range: !SelectedRange [5.0, 6.0]
            jet_pt_bin:
                - !JetPtBin
                  bin: 2
                  range: !SelectedRange [20, 40]
# Default to 2.76 central resolution parmeters
resolution_parameters:
    R22: 0.5713
    R42: &R42 0.2972
    R62: 0
    R82: 0
CorrelationsManager:
    processing_options:
        fit_correlations: false
        plot_RPF: false
        plot_RPF_summary: false
        plot_delta_eta_fit: false
        subtract_correlations: false
        plot_subtracted_correlations: false
        # Yields
        extract_yields: true
        plot_yields: true
        # Widths
        extract_delta_phi_widths: true
        plot_delta_phi_widths: true
        extract_delta_eta_widths: false
        use_stored_delta_eta_widths: false
        plot_delta_eta_widths: false
    reaction_plane_fit:
        # The fit type will be used to retrieve the fit object from the RPF package.
        # Could be "InclusiveSignalFit" or "BackgroundFit"
        fit_type: "InclusiveSignalFit"
        fit_params:
            jetPtBiased_20_40:
                trackPt_0.5_1.0:
                    args:
                        v2_a: 0.01
                        limit_v2_a: [0.005, 0.02]
                trackPt_1.0_1.5:
                    args:
                        v2_a: 0.02
                        limit_v2_a: [0.01, 0.03]
                trackPt_1.5_2.0:
                    args:
                        v2_a: 0.035
                        limit_v2_a: [0.02, 0.055]
                trackPt_2.0_3.0:
                    args:
                        # Signal terms
                        #fix_BG: true
                        #BG: 0
                        #ns_amplitude: 1.0
                        #as_amplitude: 0.2
                        # Background terms
                        <<: *fixed_v4
                        v2_t: 0.04
                        limit_v2_t: [0.01, 0.20]
                        v2_a: 0.05
                        limit_v2_a: [0.03, 0.07]
                        v3: 0.0015
                #    use_log_likelihood: true
                trackPt_3.0_4.0:
                    args:
                        <<: *fixed_v4
                        v2_t: 0.04
                        limit_v2_t: [0.01, 0.20]
                        v2_a: 0.05
                        limit_v2_a: [0.03, 0.07]
                trackPt_4.0_5.0:
                    args:
                        <<: *fixed_v4
                        v2_t: 0.04
                        limit_v2_t: [0.01, 0.20]
                        v2_a: 0.05
                        limit_v2_a: [0.03, 0.07]
                #    use_log_likelihood: true
                trackPt_5.0_6.0:
                    args:
                        <<: *fixed_v4
                #    use_log_likelihood: true
                trackPt_6.0_10.0:
                    args:
                        <<: *fixed_v4
                    use_log_likelihood: true
    override:
        # NOTE: The final value is the task name of the Correlations tasks. This is intentionally selected
        #       so that the output is stored in the same directory.
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{trainNumber}/dev/{event_activity}/{leading_hadron_bias}/Correlations"
        2.76:
            trainNumber: 3360
        5.02:
            trainNumber: 4358
        # Event plane resolution parameters
        central:
            resolution_parameters:
                R22: 0.5713
                R42: 0.2972
                R62: 0
                R82: 0
        semi_central:
            resolution_parameters:
                R22: 0.7275
                R42: 0.4424
                R62: 0
                R82: 0

##################################################
# General histograms for the correlation analysis.
##################################################
GeneralHists:
    enabled: false
    componentsToPlot:
        EventCuts: &EventCutsPlots
            CutStats: !HistPlotter
                kwargs:
                    title: "Cut stats"
                    exact_name_match: true
                    text_label:
                        enabled: true
                        textLocation: [0.82, 0.08]
                    hist_names:
                        - "fCutStats": "Before cuts"
                        - "fCutStatsAfterTrigger": "After trigger selection"
                        - "fCutStatsAfterMultSelection": "After MultSelection"
            NormalizationHist: !HistPlotter
                kwargs:
                    title: "Event selection normalization"
                    text_label:
                        enabled: true
                    hist_names:
                        - "fNormalizationHist": ""
            ZVertex: !HistPlotter
                kwargs:
                    title: "Z vertex"
                    exact_name_match: true
                    x_limits: [-20, 20]
                    text_label:
                        enabled: true
                        textLocation: [0.5, 0.1]
                    hist_names:
                        - "Vtz_raw": "Before event cuts"
                        - "Vtz_selected": "After event cuts"
            Centrality: !HistPlotter
                kwargs:
                    title: "Centrality"
                    y_limits: [3e5, 4.5e5]
                    text_label:
                        enabled: true
                        textLocation: [0.5, 0.1]
                    hist_names:
                        - "Centrality_raw": "Before event cuts"
                        - "Centrality_selected": "After event cuts"
            MultiplicityVsCentralityBeforeCuts: !HistPlotter
                kwargs:
                    logz: true
                    text_label:
                        enabled: true
                    hist_names:
                        - "MultCentCorrelation_raw": ""
            MultiplicityVsCentralityAfterCuts: !HistPlotter
                kwargs:
                    logz: true
                    text_label:
                        enabled: true
                    hist_names:
                        - "MultCentCorrelation_selected": ""
        ZVertex: !HistPlotter
            kwargs:
                title: "Z vertex"
                x_limits: [-15, 15]
                logy: true
                text_label:
                    enabled: true
                    textLocation: [0.5, 0.1]
        Centrality: !HistPlotter
            kwargs:
                title: "Centrality"
                scientific_notation_on_axis: "y"
                text_label:
                    enabled: true
        EventPlane: !HistPlotter
            kwargs:
                title: "Event plane orientations"
                x_limits: [-2.5, 2.5]
                text_label:
                    enabled: true
                    textLocation: [0.1, 0.9]
        JetMatchingSameEventCuts: !HistPlotter
            kwargs:
                text_label:
                    enabled: true
        JetMatchingMixedEventCuts: !HistPlotter
            kwargs:
                text_label:
                    enabled: true
        TrackPt: !HistPlotter
            kwargs:
                title: Associated track $p_{\mathrm{T}}$
                x_label: $p_{\mathrm{T}}^{\mathrm{assoc}}$
                y_label: $\mathrm{d}N/\mathrm{d}p_{\mathrm{T}}$
                logy: true
                text_label:
                    enabled: true
        JetPt: !HistPlotter
            kwargs:
                title: Jet $p_{\mathrm{T}}$
                logy: true
                text_label:
                    enabled: true
                hist_names:
                    - "fHistJetPt_0": "0-10\\%"
                    - "fHistJetPt_1": "10-30\\%"
                    - "fHistJetPt_2": "30-50\\%"
                    - "fHistJetPt_3": "50-90\\%"
        JetPtBias: !HistPlotter
            kwargs:
                title: Jet $p_{\mathrm{T}}$ which passes bias
                logy: true
                text_label:
                    enabled: true
                hist_names:
                    - "fHistJetPtBias_0": "0-10\\%"
                    - "fHistJetPtBias_1": "10-30\\%"
                    - "fHistJetPtBias_2": "30-50\\%"
                    - "fHistJetPtBias_3": "50-90\\%"
        JetEtaPhi: !HistPlotter
            kwargs:
                title: $\eta-\phi$ of jets in correlations
                text_label:
                    enabled: true
                    textLocation: [0.1, 0.9]
        JetHEtaPhi: !HistPlotter
            kwargs:
                title: $\eta-\phi$ of charged hadrons in correlations
                logz: true
                text_label:
                    enabled: true
    override:
        2.76:
            trainNumber: 3360
        5.02:
            trainNumber: 4358
        iterables:
            # Selected values explicitly so there are some iterables to create the object
            # (even though we don't need them).
            reaction_plane_orientation:
                - "inclusive"
            qvector:
                - "inclusive"
            task_label:
                - ""

# Pt hard bins configuration for LHC12a15e_fix embedded into LHC11h.
_ptHardBin10BinsBak: !PtHardBins &PtHardBins10BinsBak
    # Disabled here due to a bug parsing the combination of the tag and the anchor
    # yamllint disable-line rule:indentation
    bins: [5, 11, 21, 36, 57, 84, 117, 152, 191, 234, -1]
    train_numbers:
        1: 2701
        2: 2702
        3: 2703
        4: 2704
        5: 2705
        6: 2706
        7: 2707
        8: 2708
        9: 2709
        10: 2710
_ptHardBin10Bins: !PtHardBins &PtHardBins10Bins
    # Disabled here due to a bug parsing the combination of the tag and the anchor
    # yamllint disable-line rule:indentation
    bins: [5, 11, 21, 36, 57, 84, 117, 152, 191, 234, -1]
    train_numbers:
        1: 4477
        2: 4478
        3: 4479
        4: 4480
        5: 4481
        6: 4482
        7: 4483
        8: 4484
        9: 4485
        10: 4486
_testPtHardBins: &TestPtHardBin
    - !PtHardBin
      bin: 4
      range: !SelectedRange [36, 57]
      train_number: 1234

# Response matrix related configuration
PtHardBins:
    moving_average_threshold: &outlierRemovalThreshold 1.0
    override:
        inputFilename: "trains/{collision_system}/{pt_hard_bin_train_number}/AnalysisResults.root"
        inputListName: "AliAnalysisTaskEmcalEmbeddingHelper_histos"
        # Test values:
        #inputFilename: "analysis/AnalysisResults.response.root"
        iterables:
            reaction_plane_orientation: false
            pt_hard_bin: *PtHardBins10Bins
            # Test values:
            #pt_hard_bin: *TestPtHardBin
PtHardFinal:
    override:
        # ResponseMaker
        #outputPrefix: "output/{collision_system}/{event_activity}/{leading_hadron_bias}/ResponseMaker/{task_name}"
        # JetHPerformance
        outputPrefix: "output/{collision_system}/{collision_energy}/{event_activity}/{leading_hadron_bias}/{task_name}"
        iterables:
            # Technically this is true, although not very helpful. However, we must have at least
            # one iterator, so this allows us to do so with minimal change.
            reaction_plane_orientation:
                - "inclusive"
Response:
    # Select which of the tasks (with their specification defined below) produced the response.
    #responseMatrixTask: "ResponseMaker"
    responseMatrixTask: "JetHPerformance"
    ResponseMaker:
        # Main response input
        response:
            sparse: true
            enum_name: "ResponseMakerMatchingSparse"
            input_name: "fHistMatching"
        # (Matched) part level spectra
        part_level:
            sparse: true
            enum_name: "ResponseMakerMatchingSparse"
            input_name: "fHistMatching"
        # (Matched) det level spectra
        det_level:
            sparse: true
            enum_name: "ResponseMakerMatchingSparse"
            input_name: "fHistMatching"
        unmatched_part_level:
            sparse: true
            enum_name: "ResponseMakerJetsSparse"
            input_name: "fHistJets2"
        unmatched_det_level:
            sparse: true
            enum_name: "ResponseMakerJetsSparse"
            input_name: "fHistJets1"
    JetHPerformance:
        # Main response input
        response:
            sparse: true
            enum_name: "JetHPerformanceResponseSparse"
            input_name: ["response", "fHistResponseMatrix"]
        # (Matched) part level spectra
        part_level:
            sparse: true
            enum_name: "JetHPerformanceResponseSparse"
            input_name: ["response", "fHistResponseMatrix"]
        # (Matched) det level spectra
        det_level:
            sparse: true
            enum_name: "JetHPerformanceResponseSparse"
            input_name: ["response", "fHistResponseMatrix"]
        unmatched_part_level:
            sparse: false
            input_name: ["QA", "partLevelJets", "fHistJetPt"]
        unmatched_det_level:
            sparse: false
            input_name: ["QA", "hybridLevelJets", "fHistJetPt"]
    override:
        inputFilename: "trains/{collision_system}/{pt_hard_bin_train_number}/AnalysisResults.root"
        # ResponseMaker
        # yamllint disable-line rule:line-length
        #inputListName: "AliJetResponseMaker_hybridJets_AKTFullR020_tracks_pT3000_caloClustersCombined_E3000_pt_scheme_truthJets_AKTFullR020_mcparticles_pT3000_pt_scheme_Bias0_BiasType1_EMCALfid_Cent{cent_min}_{cent_max}_histos"
        # JetHPerformance
        inputListName: "AliAnalysisTaskEmcalJetHPerformance"
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{pt_hard_bin_train_number}/{event_activity}/{leading_hadron_bias}/{task_name}/RP{reaction_plane_orientation}"
        outputFilename: "ResponseMatrixHists.root"
        # Test values:
        #inputFilename: "analysis/AnalysisResults.response.root"
        iterables:
            reaction_plane_orientation: true
            pt_hard_bin: *PtHardBins10Bins
            # Test values:
            #pt_hard_bin: *TestPtHardBin
# Final response histograms.
ResponseFinal:
    particle_level_spectra: &particleLevelSpectra
        # We only want a single jet pt bin. So we create a fake bin value.
        # NOTE: It is required to specify that the range is a SelectedRange due to
        #       the way that YAML constructs the object!
        particle_level_spectra_bin: !JetPtBin
            bin: 0
            range: !SelectedRange [20, 40]
        # Rebin to 5 GeV wide bins.
        rebin_width: 5
        # Remove the first bin of the histogram (corresponding to 0 - 5 GeV bin if the rebin was performed).
        remove_first_bin: true
        # Normalize each spectra the number of jets displayed.
        normalize_by_n_jets: true
        # Normalize at selected jet pt bin
        normalize_at_selected_jet_pt_bin: false
        normalize_at_selected_jet_pt_values: !SelectedRange [25, 35]
        # Maximum particle level pt to display.
        particle_level_max_pt: 100
        # Plot the points for each angle with a small offset.
        plot_points_with_offset: false
        y_limits: [8e-5, 0.4]
    override:
        # ResponseMaker
        # yamllint disable-line rule:line-length
        #outputPrefix: "output/{collision_system}/{event_activity}/{leading_hadron_bias}/ResponseMaker/{task_name}/RP{reaction_plane_orientation}"
        # JetHPerformance
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{collision_energy}/{event_activity}/{leading_hadron_bias}/{task_name}/RP{reaction_plane_orientation}"
        outputFilename: "ResponseMatrixHists.root"
        aliceLabel: final
        iterables:
            reaction_plane_orientation: true
ResponseManager:
    # NOTE: The histograms are saved after they are scaled, but before the particle level spectra is projected.
    read_hists_from_root_file: false
    override:
        # NOTE: The final value is the task name of the ResponseFinal tasks. This is intentionally selected
        #       so that the output is stored in the same directory.
        # ResponseMaker
        #outputPrefix: "output/{collision_system}/{event_activity}/{leading_hadron_bias}/ResponseMaker/ResponseFinal"
        # JetHPerformance
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{collision_energy}/{event_activity}/{leading_hadron_bias}/ResponseFinal"

############################################
# STAR pythia and response matrix comparison
############################################
_starPtHardBins: !PtHardBins &starPtHardBins
    # Disabled here due to a bug parsing the combination of the tag and the anchor
    # yamllint disable-line rule:indentation
    bins: [5, 10, 15, 20, 25, 30, 35, 40, 45, 55, 125]
    train_numbers:
        1: 1
        2: 2
        3: 3
        4: 4
        5: 5
        6: 6
        7: 7
        8: 8
        9: 9
        10: 10

# PYTHIA jet spectra generation.
STARJetAnalysisManager:
    pt_hard_bins: *starPtHardBins
    n_events_to_generate: 5000
    # If the seed isn't specified, it will be randomly determined in each generator object.
    #random_seed: 10
    jet_radius: 0.4
    override:
        #inputFilename: "inputData/{collision_system}/{pt_hard_bin_train_number}/AnalysisResults.root"
        outputPrefix: "trains/{collision_system}/{collision_energy}/{event_activity}/"
        iterables:
            reaction_plane_orientation: false

# Response matrix and particle level spectra
STARPtHardBins:
    moving_average_threshold: *outlierRemovalThreshold
    # Only need a very slight increase.
    mean_fractional_difference_limit: 0.011
    override:
        # yamllint disable-line rule:line-length
        inputFilename: "trains/{collision_system}/{collision_energy}/{event_activity}/{pt_hard_bin_train_number}/event_properties.npy"
        iterables:
            reaction_plane_orientation: false
            pt_hard_bin: *starPtHardBins
STARPtHardFinal:
    override:
        outputPrefix: "output/{collision_system}/{collision_energy}/{event_activity}/{leading_hadron_bias}/{task_name}"
        iterables:
            # Technically this is true, although not very helpful. However, we must have at least
            # one iterator, so this allows us to do so with minimal change.
            reaction_plane_orientation:
                - "inclusive"
STARResponse:
    override:
        # yamllint disable-line rule:line-length
        inputFilename: "trains/{collision_system}/{collision_energy}/{event_activity}/{pt_hard_bin_train_number}/jets.npy"
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{collision_energy}/{pt_hard_bin_train_number}/{event_activity}/{leading_hadron_bias}/{task_name}/RP{reaction_plane_orientation}"
        outputFilename: "ResponseMatrixHists.root"
        iterables:
            reaction_plane_orientation:
                - "inclusive"
            pt_hard_bin: *starPtHardBins
STARResponseFinal:
    particle_level_spectra:
        <<: *particleLevelSpectra
        y_limits: [1e-7, 1.1]
    override:
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{collision_energy}/{event_activity}/{leading_hadron_bias}/{task_name}/RP{reaction_plane_orientation}"
        outputFilename: "ResponseMatrixHists.root"
        iterables:
            reaction_plane_orientation:
                - "inclusive"
STARResponseManager:
    # NOTE: The histograms are saved after they are scaled, but before the particle level spectra is projected.
    read_hists_from_root_file: false
    override:
        # NOTE: The final value is the task name of the ResponseFinal tasks. This is intentionally selected
        #       so that the output is stored in the same directory.
        # ResponseMaker
        #outputPrefix: "output/{collision_system}/{event_activity}/{leading_hadron_bias}/ResponseMaker/ResponseFinal"
        # JetHPerformance
        # yamllint disable-line rule:line-length
        outputPrefix: "output/{collision_system}/{collision_energy}/{event_activity}/{leading_hadron_bias}/STARResponseFinal"

############################################################
# Configuration for plotting EMCal corrections from a train.
############################################################
EMCalCorrections:
    # Track pt bins that are used when binning various cluster-track matching histograms.
    track_pt_bins: !TrackPtBins [0.15, 0.5, 1, 1.5, 2, 3, 4, 5, 8, -1]
    componentsToPlot:
        CellEnergy:
            # Specialize via a specific histogram name
            CellEnergy: !HistPlotter
                kwargs: &CellEnergy
                    # The spectra fall off rather quickly
                    x_limits: [0, 4]
                    title: "Cell energy"
                    logy: true
                    text_label:
                        # "enabled" is not actually a real field - there just needs
                        # to be at least one field. Here, it could be removed
                        # because other values are specified, but it is kept as an
                        # example.
                        enabled: true
                        cellLabel: true
                    # If hist_names isn't specified, then we just we use the
                    # object name. Here, that is "CellEnergy"
                    # However, we specify the names so we can plot before and
                    # after on the same plot
                    hist_names:
                        - "CellEnergyDistBefore": "Before energy calibration"
                        - "CellEnergyDistAfter": "After energy calibration"
        CellBadChannel:
            CellEnergy: !HistPlotter
                kwargs:
                    <<: *CellEnergy
                    hist_names:
                        - "CellEnergyDistBefore": "Before bad channel removal"
                        - "CellEnergyDistAfter": "After bad channel removal"
        CellTimeCalib:
            CellTime: !HistPlotter
                kwargs:
                    title: "Cell time"
                    x_limits: [-300e-9, 900e-9]
                    scientific_notation_on_axis: "both"
                    text_label:
                        cellLabel: true
                    hist_names:
                        # Of the form "HistName": "HistTitle"
                        - "CellTimeDistBefore": "Before time calibration"
                        - "CellTimeDistAfter": "After time calibration"
        Clusterizer:
            ProcessingTime: !HistPlotter
                kwargs:
                    title: "Clusterizer processing time"
                    text_label:
                        enabled: true
                    hist_names:
                        - "RealTime": "Clock time"
                        - "CPUTime": "CPU time"
        ClusterExotics:
            EtaPhiDistBefore: !HistPlotter
                kwargs: &exoticsEtaPhi
                    # Don't use quotes if we are using latex
                    title: Cluster $\eta,\phi$ before exotics removal
                    output_name: "ClusterEtaPhiBeforeExotics"
                    y_limits: [1.25, 3.5]
                    logz: true
                    text_label:
                        clusterLabel: true
            EtaPhiDistAfter: !HistPlotter
                kwargs:
                    <<: *exoticsEtaPhi
                    title: Cluster $\eta,\phi$ after exotics removal
                    output_name: "ClusterEtaPhiAfterExotics"
            ExoticsRemoved: !HistPlotter
                kwargs:
                    <<: *exoticsEtaPhi
                    title: $\eta, \phi$ of cluster removed during exotic cut
                    output_name: "ClusterEtaPhiRemovedByExotics"
                    hist_names:
                        - "hExoticsEtaPhiRemoved": ""
            ExoticClusters: !HistPlotter
                kwargs:
                    title: "Energy of Exotic Clusters"
                    output_name: "ExoticClusterEnergy"
                    logy: true
                    text_label:
                        clusterLabel: true
                    hist_names:
                        - "EnergyExoticClusters": "Exotic Clusters"
        ClusterNonLinearity:
            EnergyDist: !HistPlotter
                kwargs:
                    title: "Non-linearity cluster energy spectra"
                    logy: true
                    text_label:
                        clusterLabel: true
                    hist_names:
                        - "EnergyDistBefore": "Before non-linearity"
                        - "EnergyDistAfter": "After non-linearity"
            EnergyTimeDistBefore: !HistPlotter
                kwargs: &energyTimeDist
                    y_limits: [-300e-9, 400e-9]
                    x_limits: [0, 80]
                    logz: true
                    output_name: EnergyTimeBeforeNonLinearity
                    title: Cluster energy vs time before cluster non-linearity
                    text_label:
                        clusterLabel: true
            EnergyTimeDistAfter: !HistPlotter
                kwargs:
                    <<: *energyTimeDist
                    output_name: EnergyTimeAfterNonLinearity
                    title: Cluster energy vs time after cluster non-linearity
        ClusterTrackMatcher:
            MatchDistAll: !HistPlotter
                kwargs:
                    title: "All cluster-track matches"
                    x_label: $\Delta\eta$, $\Delta\varphi$
                    x_limits: [-0.12, 0.12]
                    text_label: &matchDistLabel
                        clusterLabel: true
                        trackLabel: true
                        textLocation: [0.25, 0.9]
                    hist_names:
                        - "MatchEtaAll": $\eta$ matches
                        - "MatchPhiAll": $\varphi$ matches
            MatchDifferential1: !HistPlotter
                kwargs: &matchDifferential
                    title: $\Delta\eta$, $\Delta\varphi$ matches
                    x_label: $\Delta\eta$, $\Delta\varphi$
                    x_limits: [-0.12, 0.12]
                    scientific_notation_on_axis: "y"
                    text_label:
                        <<: *matchDistLabel
                    hist_names:
                        - "fHistMatch{angle}_{cent}_{pt_bin}_{eta_direction}": ""
                    processing: &matchDifferentialProcessing
                        func_name: "eta_phi_match_hist_names"
                        angles: ["Eta", "Phi"]
                        cent_bins:
                            - 0: "Pos. tracks"
                            - 5: "Neg. tracks"
                        pt_bins: [1]
                        eta_directions:
                            - 0: $\eta < 0$
                            - 1: $\eta > 0$
            MatchDifferential2: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [2]
            MatchDifferential3: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [3]
            MatchDifferential4: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [4]
            MatchDifferential5: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [5]
            MatchDifferential6: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [6]
            MatchDifferential7: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [7]
            MatchDifferential8: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [8]
            MatchDifferential9: !HistPlotter
                kwargs:
                    <<: *matchDifferential
                    processing:
                        <<: *matchDifferentialProcessing
                        pt_bins: [9]
        ClusterHadronicCorrection:
            # By following the same order as how the histograms are stored in the file,
            # we can be assured that the proper hist is matched to the proper config.
            MatchEtaPhiAll: !HistPlotter
                kwargs:
                    title: $\Delta\eta$, $\Delta\varphi$ matches (track $\leftrightarrow$ cluster)
                    output_name: "EtaPhiMatches"
                    logz: true
                    exact_name_match: true
                    text_label:
                        <<: *matchDistLabel
                        textLocation: [0.35, 0.92]
                    hist_names:
                        - "fHistMatchEtaPhiAll": "Matches"
            MatchEtaPhiAllCl: !HistPlotter
                kwargs:
                    title: $\Delta\eta$, $\Delta\varphi$ matches from clusters
                    output_name: "EtaPhiMatchesFromClusters"
                    logz: true
                    exact_name_match: true
                    text_label:
                        <<: *matchDistLabel
                        textLocation: [0.35, 0.92]
                    hist_names:
                        - "fHistMatchEtaPhiAllCl": "Matches"
            TrackPESub: !HistPlotter
                kwargs:
                    output_name: "TrackPESub"
                    x_label: $\sum p$ (GeV) weighted with $E_{\mathrm{sub}}$
                    x_limits: [0, 175]
                    logy: true
                    text_label: &clusterTrackLabel
                        clusterLabel: true
                        trackLabel: true
                    hist_names:
                        # 0, 5 are 0-10%
                        - "fHistEsubPch_0": "Positive charged tracks"
                        - "fHistEsubPch_5": "Negative charged tracks"
            TrackPVsEOverPRatio: !HistPlotter
                kwargs:
                    output_name: "TrackPEOverPRatio"
                    # yamllint disable-line rule:line-length
                    title: $\sum p_{\mathrm{track}}$ vs $E_{\mathrm{cluster}}$ / $\sum p_{\mathrm{track}}$ using all matches
                    x_limits: [0, 150]
                    y_limits: [0, 1.1]
                    logz: true
                    text_label: &clusterTrackLabelRight
                        <<: *clusterTrackLabel
                        textLocation: [0.71, 0.92]
                    hist_names:
                        # 0 is 0-10%
                        - "fHistEsubPchRatAll_0": ""
            EClusVsEOverPRatio: !HistPlotter
                kwargs:
                    output_name: "ClusterEoverPRatio"
                    # yamllint disable-line rule:line-length
                    title: $E_{\mathrm{cluster}}$ vs $E_{\mathrm{cluster}}$ / $\sum p_{\mathrm{track}}$ using all matches
                    x_limits: [0, 150]
                    logz: true
                    text_label:
                        <<: *clusterTrackLabelRight
                    hist_names:
                        # 0 is 0-10%
                        - "fHistMatchEvsP_0": ""
            EOverPVsCent: !HistPlotter
                kwargs:
                    output_name: "EOverPCent"
                    title: &eOverPVsCentTitle $E_{\mathrm{cluster}}$ / $p_{\mathrm{track}}$ vs Cent
                    logz: true
                    text_label:
                        <<: *clusterTrackLabel
                        textLocation: [0.35, 0.15]
                    hist_names:
                        - "EoPCent": ""
            NMatchesVsCent: !HistPlotter
                kwargs:
                    title: &nMatchesVsCentTitle "N matches vs centrality"
                    logz: true
                    text_label:
                        <<: *clusterTrackLabel
                    hist_names:
                        - "NMatchesCent": *nMatchesVsCentTitle
            # Oversubtracted hists
            OversubVsClusE: !HistPlotter
                kwargs:
                    output_name: "OversubVsClusE"
                    title: Oversubtracted E vs $E_{\textrm{cluster}}$
                    logz: true
                    text_label:
                        <<: *clusterTrackLabel
                    hist_names:
                        - "fHistOversub_0": ""
            OversubVsClusEFromEmbedClusters: !HistPlotter
                kwargs:
                    output_name: "OversubVsClusEFromEmbedClusters"
                    title: Oversubtracted E vs $E_{\textrm{cluster}}$ for embedded dominated clusters
                    logz: true
                    text_label:
                        <<: *clusterTrackLabel
                    hist_names:
                        - "fHistOversubMCClusters_0": ""
            OversubVsClusEFromDataClusters: !HistPlotter
                kwargs:
                    output_name: "OversubVsClusEFromDataClusters"
                    title: Oversubtracted E vs $E_{\textrm{cluster}}$ for data dominated clusters
                    logz: true
                    text_label:
                        <<: *clusterTrackLabel
                    hist_names:
                        - "fHistOversubNonMCClusters_0": ""
            OversubVsClusEFromEmbedTracks: !HistPlotter
                kwargs:
                    output_name: "OversubVsClusEFromEmbedTracks"
                    title: Oversubtracted E vs $E_{\textrm{cluster}}$ for embedded dominated tracks
                    logz: true
                    text_label:
                        <<: *clusterTrackLabel
                    hist_names:
                        - "fHistEmbTrackMatchesOversub_0": ""
            OversubVsClusEFromDataTracks: !HistPlotter
                kwargs:
                    output_name: "OversubVsClusEFromDataTracks"
                    title: Oversubtracted E vs $E_{\textrm{cluster}}$ for data dominated tracks
                    logz: true
                    text_label:
                        <<: *clusterTrackLabel
                    hist_names:
                        - "fHistNonEmbTrackMatchesOversub_0": ""
    override:
        inputListName: "AliEmcalCorrectionTask{corrections_label}_histos"
        iterables:
            reaction_plane_orientation:
                - "inclusive"
            qvector:
                - "inclusive"
            task_label:
                - "standard"
                #- "embed"
                #- "combined"
                #- "data"

# Configuration for plotting EMCal Embedding related histograms.
EMCalEmbedding:
    componentsToPlot:
        EventCuts:
            <<: *EventCutsPlots
        CrossSection:
            text_label:
                enabled: true
            hist_names:
                - "fHistXSection": "Pythia Cross Section"
        Trials:
            text_label:
                enabled: true
        PtHard:
            text_label:
                enabled: true
        EmbeddedEventRejection:
            scientific_notation_on_axis: "y"
            text_label:
                enabled: true
        EmbeddedEventsAttempted:
            x_limits: [0, 200]
            logy: true
            scientific_notation_on_axis: "y"
            text_label:
                enabled: true
        NumberOfFiles:
            y_label: "Number"
            text_label:
                enabled: true
        AbsoluteFileNumber:
            x_label: "File number"
            y_label: "Number"
            text_label:
                enabled: true
        InternalEventCuts:
            text_label:
                enabled: true
    override:
        inputListName: "AliAnalysisTaskEmcalEmbeddingHelper_histos"
        trainNumber: 3231
        iterables:
            reaction_plane_orientation: false
            pt_hard_bin: *PtHardBins10Bins
